<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ラッキーパネル補助ツール</title>
<link rel="icon" href="LuckyPanel_favicon.png" type="image/png">
<link rel="apple-touch-icon" href="LuckyPanel_favicon.png">

<style>
    :root {
        --ls-cell-h: calc((100vh - 90px) / 4);
        --ls-cell-w: calc((100vw - 360px) / 6);
        --ls-final-cell: min(var(--ls-cell-h), var(--ls-cell-w));
    }

    body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        background-color: #f8f9fa;
        color: #333;
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        -webkit-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
        overscroll-behavior: none;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        justify-content: center;
        overflow: hidden; 
    }

    h1 {
        margin: 0;
        padding: 5px 0;
        font-size: 1.2rem;
        color: #444;
        text-align: center;
        line-height: 1.2;
    }

    .portrait-hint {
        font-size: 0.8rem;
        color: #ffe0e6;
        text-align: center;
        margin-top: 8px;
        font-weight: bold;
    }

    .layout-container {
        width: 100%;
        max-width: 600px;
        padding: 10px;
        box-sizing: border-box;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .area-title   { order: 1; width: 100%; display: flex; justify-content: center; flex-shrink: 0; }
    .area-modes   { order: 2; width: 100%; display: flex; justify-content: center; margin-bottom: 8px; flex-shrink: 0; }
    .area-actions { order: 3; width: 100%; display: flex; justify-content: center; margin-bottom: 10px; flex-shrink: 0; }
    .area-status  { order: 4; width: 100%; display: flex; justify-content: center; margin-bottom: 5px; flex-shrink: 0; }
    .area-grid    { order: 5; width: 100%; display: flex; flex-direction: column; align-items: center; flex-grow: 1; overflow: hidden; }

    .mode-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    .action-group { display: flex; gap: 15px; justify-content: center; width: 100%; max-width: 400px; flex-direction: row; }
    
    .mode-btn {
        padding: 8px 12px; font-size: 0.9rem; border: 2px solid #ddd; border-radius: 20px;
        cursor: pointer; background-color: #fff; color: #555; transition: all 0.2s; font-weight: bold; white-space: nowrap;
    }
    .mode-btn.active { background-color: #007bff; color: white; border-color: #007bff; box-shadow: 0 2px 5px rgba(0,123,255,0.3); }

    .action-btn {
        padding: 10px 0; font-size: 1rem; border: none; border-radius: 4px;
        cursor: pointer; color: white; transition: background-color 0.2s; flex: 1; white-space: nowrap;
    }
    #resetBtn { background-color: #6c757d; }
    #nextBtn { background-color: #007bff; }

    .status-bar { font-weight: bold; height: 1.5em; color: #555; display: flex; align-items: center; }
    .next-char { color: #d35400; font-size: 1.2em; margin-left: 5px; }

    .grid-board {
        display: grid; gap: 4px; background-color: #555; padding: 6px;
        border-radius: 8px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); touch-action: none; height: fit-content; 
    }

    .cell {
        width: 50px; height: 50px; background-color: #fff; display: flex; justify-content: center; align-items: center;
        font-size: 1.4rem; font-weight: bold; cursor: pointer; border-radius: 4px;
        box-shadow: inset 0 0 2px rgba(0,0,0,0.1); transition: transform 0.1s; color: #444;
        position: relative; box-sizing: border-box; border: 2px solid transparent;
    }
    @media (max-width: 360px) { .cell { width: 42px; height: 42px; font-size: 1.1rem; } }

    .cell.empty { background-color: #e9ecef; color: transparent; border: 2px solid #e9ecef; }
    .cell.filler { background-color: #555; border: 1px solid #666; cursor: default; box-shadow: none; pointer-events: none; }
    
    .bg-A { background-color: #ff97a2; } .bg-B { background-color: #85abf1; } .bg-C { background-color: #f7cf86; }
    .bg-D { background-color: #eaad48; } .bg-E { background-color: #c5af9c; } .bg-F { background-color: #c8e6c9; }
    .bg-G { background-color: #a3d07d; } .bg-H { background-color: #ffc0cb; } .bg-I { background-color: #b3e5fc; }
    .bg-J { background-color: #babec7; } .bg-K { background-color: #fbfff0; }
    .bg-star { background-color: #fff176; color: #f57f17; border: 2px solid #fbc02d; }
    .bg-close { background-color: #e1bee7; color: #8e44ad; font-weight: 900; border: 2px solid #ce93d8; }
    .cell:not(.empty):not(.bg-star):not(.bg-close):not(.filler) { border: 2px solid rgba(0,0,0,0.1); }
    .cell.dragging { opacity: 0.6; transform: scale(1.1); z-index: 999; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .cell.over { border: 2px dashed #007bff !important; opacity: 0.8; transform: scale(0.95); }

    @media (orientation: landscape) {
        .layout-container {
            display: grid;
            grid-template-columns: auto auto 85px;
            grid-template-rows: auto auto 1fr;
            grid-template-areas: "title title title" "status status status" "modes grid actions";
            width: 100%; height: 100vh; max-width: none; padding: 5px 10px; column-gap: 20px; row-gap: 2px;
        }
        .area-title, .area-status { order: initial; margin: 0; padding: 0; }
        .area-title { grid-area: title; } .area-status { grid-area: status; }
        h1 { font-size: 1rem; padding: 2px 0; }
        .status-bar { height: 1.2em; font-size: 0.9rem; margin-bottom: 2px; }
        .area-modes { grid-area: modes; height: 100%; display: flex; align-items: flex-start; justify-content: flex-end; padding-top: 6px; }
        .area-actions { grid-area: actions; height: 100%; display: flex; align-items: flex-start; justify-content: flex-start; padding-top: 6px; padding-bottom: 6px; }
        .area-grid { grid-area: grid; height: 100%; display: flex; justify-content: center; align-items: flex-start; overflow: hidden; }
        .mode-group { flex-direction: column; gap: 4px; width: auto; }
        .mode-btn { width: auto; text-align: center; padding: 0 12px; font-size: 1rem; margin: 0; box-sizing: border-box; height: var(--ls-final-cell); display: flex; align-items: center; justify-content: center; }
        .action-group { flex-direction: column-reverse; justify-content: space-between; gap: 15px; width: 100%; height: 100%; max-width: none; }
        .action-btn { width: 100%; padding: 0; display: flex; justify-content: center; align-items: center; flex-grow: 1; font-size: 1.1rem; }
        .grid-board { 
            margin: 0 auto; box-sizing: border-box; width: fit-content; height: auto;
            grid-template-columns: repeat(6, var(--ls-final-cell)) !important;
            grid-template-rows: repeat(4, var(--ls-final-cell)) !important;
        }
        .cell { width: var(--ls-final-cell); height: var(--ls-final-cell); font-size: calc(var(--ls-final-cell) * 0.5); }
        .portrait-hint { display: none; }
    }
</style>
</head>
<body>
    <div class="layout-container">
        <div class="area-title"><h1>ラッキーパネル補助ツール</h1></div>
        <div class="area-modes"><div class="mode-group"><button class="mode-btn" id="btnMode1" onclick="selectMode(1)">①甘口</button><button class="mode-btn" id="btnMode2" onclick="selectMode(2)">②中辛</button><button class="mode-btn" id="btnMode3" onclick="selectMode(3)">③辛口</button><button class="mode-btn" id="btnMode4" onclick="selectMode(4)">④激辛</button></div></div>
        <div class="area-grid"><div class="grid-board" id="grid"></div><div class="portrait-hint">※横向き推奨</div></div>
        <div class="area-actions"><div class="action-group" id="actionGroup"><button class="action-btn" id="resetBtn" onclick="resetCurrentGame()">リセット</button><button class="action-btn" id="nextBtn" onclick="nextMode()">次へ</button></div></div>
        <div class="area-status"><div class="status-bar" id="statusBar">次は:<span class="next-char" id="nextCharDisplay">-</span></div></div>
    </div>
<script>
    const modes={1:{rows:3,cols:4,colOffset:1,chars:['A','B','C','D','E']},2:{rows:4,cols:4,colOffset:1,chars:['A','B','C','D','E','F','G']},3:{rows:4,cols:5,colOffset:1,chars:['A','B','C','D','E','F','G','H','I']},4:{rows:4,cols:6,colOffset:0,chars:['A','B','C','D','E','F','G','H','I','J','K']}};
    const colorMap={'A':'bg-A','B':'bg-B','C':'bg-C','D':'bg-D','E':'bg-E','F':'bg-F','G':'bg-G','H':'bg-H','I':'bg-I','J':'bg-J','K':'bg-K','★':'bg-star','〆':'bg-close'};
    let currentModeId=1,supplyQueue=[],dragSrcEl=null;
    const gridElement=document.getElementById('grid'),nextCharDisplay=document.getElementById('nextCharDisplay'),statusBar=document.getElementById('statusBar'),actionGroup=document.getElementById('actionGroup');
    function selectMode(id){currentModeId=id;document.querySelectorAll('.mode-btn').forEach(btn=>btn.classList.remove('active'));document.getElementById(`btnMode${id}`).classList.add('active');initGame();}
    function nextMode(){let n=currentModeId+1;if(n>4)n=1;selectMode(n);}
    function resetCurrentGame(){initGame();}
    function initGame(){
        const c=modes[currentModeId];supplyQueue=[];
        c.chars.forEach(ch=>{supplyQueue.push(ch);supplyQueue.push(ch);});
        supplyQueue.push('★','〆');updateStatus();
        gridElement.innerHTML='';
        const isL=window.matchMedia("(orientation: landscape)").matches;
        if(isL){
            for(let r=0;r<4;r++)for(let l=0;l<6;l++)createCell(r<c.rows&&l>=c.colOffset&&l<c.colOffset+c.cols);
            updateActionGroupHeight();
        }else{
            for(let i=0;i<c.rows*c.cols;i++)createCell(true);
        }
    }
    function updateActionGroupHeight(){const s=document.querySelector('.cell');if(s){const h=s.getBoundingClientRect().height;actionGroup.style.height=`${(h*4)+(4*3)+12}px`;}}
    function createCell(a){const e=document.createElement('div');e.classList.add('cell');if(!a)e.classList.add('filler');else{e.classList.add('empty');addEvents(e);}gridElement.appendChild(e);}
    function updateStatus(){nextCharDisplay.textContent=supplyQueue.length?supplyQueue[0]:"完了";statusBar.style.visibility=supplyQueue.length?'visible':'hidden';}
    function setItemToCell(e,i){e.textContent=i;e.className='cell '+(colorMap[i]||'');}
    function swapCells(s,t){const x=s.textContent,y=s.className;s.textContent=t.textContent;s.className=t.className;t.textContent=x;t.className=y;}
    function addEvents(e){
        e.onclick=()=>{if(supplyQueue.length)setItemToCell(e,supplyQueue.shift()),updateStatus();};
        e.draggable=true;
        e.ondragstart=()=>dragSrcEl=e;
        e.ondragover=v=>v.preventDefault();
        e.ondrop=()=>{if(dragSrcEl!==e)swapCells(dragSrcEl,e);};
        e.addEventListener('touchstart',v=>{if(v.touches.length===1){dragSrcEl=e;}},{passive:true});
        e.addEventListener('touchend',v=>{const t=document.elementFromPoint(v.changedTouches[0].clientX,v.changedTouches[0].clientY);if(t&&t.classList.contains('cell')&&!t.classList.contains('filler')&&t!==dragSrcEl)swapCells(dragSrcEl,t);else if(t===e&&supplyQueue.length)setItemToCell(e,supplyQueue.shift()),updateStatus();},{passive:false});
    }
    selectMode(1);
</script>
</body>
</html>
